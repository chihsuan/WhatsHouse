!function(e,s,t,r){e.fn.search=function(t,n){var a,i=e(this),o=i.selector||"",l=(new Date).getTime(),c=[],u=arguments[0],d="string"==typeof u,f=[].slice.call(arguments,1);return e(this).each(function(){var p,h=e.extend(!0,{},e.fn.search.settings,n),m=h.className,g=h.selector,v=h.error,y=h.namespace,b="."+y,w=y+"-module",x=e(this),C=x.find(g.prompt),R=x.find(g.searchButton),A=x.find(g.results),T=(x.find(g.result),x.find(g.category),this),k=x.data(w);p={initialize:function(){p.verbose("Initializing module");var e=C[0],s=e.oninput!==r?"input":e.onpropertychange!==r?"propertychange":"keyup";C.on("focus"+b,p.event.focus).on("blur"+b,p.event.blur).on("keydown"+b,p.handleKeyboard),h.automatic&&C.on(s+b,p.search.throttle),R.on("click"+b,p.search.query),A.on("click"+b,g.result,p.results.select),p.instantiate()},instantiate:function(){p.verbose("Storing instance of module",p),k=p,x.data(w,p)},destroy:function(){p.verbose("Destroying instance"),x.removeData(w)},event:{focus:function(){x.addClass(m.focus),p.results.show()},blur:function(){p.search.cancel(),x.removeClass(m.focus),p.results.hide()}},handleKeyboard:function(s){var t,r=x.find(g.result),n=x.find(g.category),a=s.which,i={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},o=m.active,l=r.index(r.filter("."+o)),c=r.size();if(a==i.escape&&(p.verbose("Escape key pressed, blurring search field"),C.trigger("blur")),A.filter(":visible").size()>0)if(a==i.enter){if(p.verbose("Enter key pressed, selecting active result"),r.filter("."+o).exists())return e.proxy(p.results.select,r.filter("."+o))(),s.preventDefault(),!1}else a==i.upArrow?(p.verbose("Up key pressed, changing active result"),t=0>l-1?l:l-1,n.removeClass(o),r.removeClass(o).eq(t).addClass(o).closest(n).addClass(o),s.preventDefault()):a==i.downArrow&&(p.verbose("Down key pressed, changing active result"),t=l+1>=c?l:l+1,n.removeClass(o),r.removeClass(o).eq(t).addClass(o).closest(n).addClass(o),s.preventDefault());else a==i.enter&&(p.verbose("Enter key pressed, executing query"),p.search.query(),R.addClass(m.down),C.one("keyup",function(){R.removeClass(m.down)}))},search:{cancel:function(){var e=x.data("xhr")||!1;e&&"resolved"!=e.state()&&(p.debug("Cancelling last search"),e.abort())},throttle:function(){var e=C.val(),s=e.length;clearTimeout(p.timer),s>=h.minCharacters?p.timer=setTimeout(p.search.query,h.searchThrottle):p.results.hide()},query:function(){var s=C.val(),r=p.search.cache.read(s);r?(p.debug("Reading result for '"+s+"' from cache"),p.results.add(r)):(p.debug("Querying for '"+s+"'"),"object"==typeof t?p.search.local(s):p.search.remote(s),e.proxy(h.onSearchQuery,x)(s))},local:function(s){var r,n=[],a=[],i=e.isArray(h.searchFields)?h.searchFields:[h.searchFields],o=new RegExp("(?:s|^)"+s,"i"),l=new RegExp(s,"i");x.addClass(m.loading),e.each(i,function(s,r){e.each(t,function(s,t){"string"==typeof t[r]&&-1==e.inArray(t,n)&&-1==e.inArray(t,a)&&(o.test(t[r])?n.push(t):l.test(t[r])&&a.push(t))})}),r=p.results.generate({results:e.merge(n,a)}),x.removeClass(m.loading),p.search.cache.write(s,r),p.results.add(r)},remote:function(s){var r,n={stateContext:x,url:t,urlData:{query:s},success:function(e){r=p.results.generate(e),p.search.cache.write(s,r),p.results.add(r)},failure:p.error};p.search.cancel(),p.debug("Executing search"),e.extend(!0,n,h.apiSettings),e.api(n)},cache:{read:function(e){var s=x.data("cache");return h.cache&&"object"==typeof s&&s[e]!==r?s[e]:!1},write:function(e,s){var t=x.data("cache")!==r?x.data("cache"):{};t[e]=s,x.data("cache",t)}}},results:{generate:function(s){p.debug("Generating html from response",s);var t=h.templates[h.type],r="";return e.isPlainObject(s.results)&&!e.isEmptyObject(s.results)||e.isArray(s.results)&&s.results.length>0?(h.maxResults>0&&(s.results=e.makeArray(s.results).slice(0,h.maxResults)),s.results.length>0&&(e.isFunction(t)?r=t(s):p.error(v.noTemplate,!1))):r=p.message(v.noResults,"empty"),e.proxy(h.onResults,x)(s),r},add:function(s){("default"==h.onResultsAdd||"default"==e.proxy(h.onResultsAdd,A)(s))&&A.html(s),p.results.show()},show:function(){0===A.filter(":visible").size()&&C.filter(":focus").size()>0&&""!==A.html()&&(A.stop().fadeIn(200),e.proxy(h.onResultsOpen,A)())},hide:function(){A.filter(":visible").size()>0&&(A.stop().fadeOut(200),e.proxy(h.onResultsClose,A)())},select:function(t){p.debug("Search result selected");var r=e(this),n=r.find(".title"),a=n.html();if("default"==h.onSelect||"default"==e.proxy(h.onSelect,this)(t)){var i=r.find("a[href]").eq(0),o=i.attr("href")||!1,l=i.attr("target")||!1;p.results.hide(),C.val(a),o&&("_blank"==l||t.ctrlKey?s.open(o):s.location.href=o)}}},setting:function(s,t){if(e.isPlainObject(s))e.extend(!0,h,s);else{if(t===r)return h[s];h[s]=t}},internal:function(s,t){if(e.isPlainObject(s))e.extend(!0,p,s);else{if(t===r)return p[s];p[s]=t}},debug:function(){h.debug&&(h.performance?p.performance.log(arguments):(p.debug=Function.prototype.bind.call(console.info,console,h.name+":"),p.debug.apply(console,arguments)))},verbose:function(){h.verbose&&h.debug&&(h.performance?p.performance.log(arguments):(p.verbose=Function.prototype.bind.call(console.info,console,h.name+":"),p.verbose.apply(console,arguments)))},error:function(){p.error=Function.prototype.bind.call(console.error,console,h.name+":"),p.error.apply(console,arguments)},performance:{log:function(e){var s,t,r;h.performance&&(s=(new Date).getTime(),r=l||s,t=s-r,l=s,c.push({Element:T,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":t})),clearTimeout(p.performance.timer),p.performance.timer=setTimeout(p.performance.display,100)},display:function(){var s=h.name+":",t=0;l=!1,clearTimeout(p.performance.timer),e.each(c,function(e,s){t+=s["Execution Time"]}),s+=" "+t+"ms",o&&(s+=" '"+o+"'"),i.size()>1&&(s+=" ("+i.size()+")"),(console.group!==r||console.table!==r)&&c.length>0&&(console.groupCollapsed(s),console.table?console.table(c):e.each(c,function(e,s){console.log(s.Name+": "+s["Execution Time"]+"ms")}),console.groupEnd()),c=[]}},invoke:function(s,t,n){var i,o,l,c=k;return t=t||f,n=T||n,"string"==typeof s&&c!==r&&(s=s.split(/[\. ]/),i=s.length-1,e.each(s,function(t,n){var a=t!=i?n+s[t+1].charAt(0).toUpperCase()+s[t+1].slice(1):s;if(e.isPlainObject(c[a])&&t!=i)c=c[a];else{if(c[a]!==r)return o=c[a],!1;if(!e.isPlainObject(c[n])||t==i)return c[n]!==r?(o=c[n],!1):!1;c=c[n]}})),e.isFunction(o)?l=o.apply(n,t):o!==r&&(l=o),e.isArray(a)?a.push(l):a!==r?a=[a,l]:l!==r&&(a=l),o}},d?(k===r&&p.initialize(),p.invoke(u)):(k!==r&&p.destroy(),p.initialize())}),a!==r?a:this},e.fn.search.settings={name:"Search Module",namespace:"search",debug:!1,verbose:!0,performance:!0,onSelect:"default",onResultsAdd:"default",onSearchQuery:function(){},onResults:function(){},onResultsOpen:function(){},onResultsClose:function(){},automatic:"true",type:"simple",minCharacters:3,searchThrottle:300,maxResults:7,cache:!0,searchFields:["title","description"],apiSettings:{},className:{active:"active",down:"down",focus:"focus",empty:"empty",loading:"loading"},error:{noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noTemplate:"A valid template name was not specified.",serverError:"There was an issue with querying the server.",method:"The method you called is not defined."},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result"},templates:{message:function(e,s){var t="";return e!==r&&s!==r&&(t+='<div class="message '+s+'">',t+="empty"==s?'<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':' <div class="description">'+e+"</div>",t+="</div>"),t},categories:function(s){var t="";return s.results!==r?(e.each(s.results,function(s,n){n.results!==r&&n.results.length>0&&(t+='<div class="category"><div class="name">'+n.name+"</div>",e.each(n.results,function(e,s){t+='<div class="result">',t+='<a href="'+s.url+'"></a>',s.image!==r&&(t+='<div class="image"> <img src="'+s.image+'"></div>'),t+='<div class="info">',s.price!==r&&(t+='<div class="price">'+s.price+"</div>"),s.title!==r&&(t+='<div class="title">'+s.title+"</div>"),s.description!==r&&(t+='<div class="description">'+s.description+"</div>"),t+="</div></div>"}),t+="</div>")}),s.resultPage&&(t+='<a href="'+s.resultPage.url+'" class="all">'+s.resultPage.text+"</a>"),t):!1},simple:function(s){var t="";return s.results!==r?(e.each(s.results,function(e,s){t+='<a class="result" href="'+s.url+'">',s.image!==r&&(t+='<div class="image"> <img src="'+s.image+'"></div>'),t+='<div class="info">',s.price!==r&&(t+='<div class="price">'+s.price+"</div>"),s.title!==r&&(t+='<div class="title">'+s.title+"</div>"),s.description!==r&&(t+='<div class="description">'+s.description+"</div>"),t+="</div></a>"}),s.resultPage&&(t+='<a href="'+s.resultPage.url+'" class="all">'+s.resultPage.text+"</a>"),t):!1}}}}(jQuery,window,document);