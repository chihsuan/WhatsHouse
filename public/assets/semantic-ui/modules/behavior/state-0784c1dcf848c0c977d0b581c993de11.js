!function(e,t,n,o){e.fn.state=function(t){var n,a=e(this),i=e.extend(!0,{},e.fn.state.settings,t),s=a.selector||"",r=(new Date).getTime(),c=[],u=arguments[0],l="string"==typeof u,d=[].slice.call(arguments,1),f=(i.error,i.metadata),v=i.className,g=i.namespace,b=i.states,m=i.text,x="."+g,h=g+"-module";return a.each(function(){var g,p=e(this),w=this,y=p.data(h);g={initialize:function(){g.verbose("Initializing module"),i.automatic&&g.add.defaults(),i.context&&""!==s?(g.allows("hover")&&e(w,i.context).on(s,"mouseenter"+x,g.enable.hover).on(s,"mouseleave"+x,g.disable.hover),g.allows("down")&&e(w,i.context).on(s,"mousedown"+x,g.enable.down).on(s,"mouseup"+x,g.disable.down),g.allows("focus")&&e(w,i.context).on(s,"focus"+x,g.enable.focus).on(s,"blur"+x,g.disable.focus),e(i.context).on(s,"mouseenter"+x,g.change.text).on(s,"mouseleave"+x,g.reset.text).on(s,"click"+x,g.toggle.state)):(g.allows("hover")&&p.on("mouseenter"+x,g.enable.hover).on("mouseleave"+x,g.disable.hover),g.allows("down")&&p.on("mousedown"+x,g.enable.down).on("mouseup"+x,g.disable.down),g.allows("focus")&&p.on("focus"+x,g.enable.focus).on("blur"+x,g.disable.focus),p.on("mouseenter"+x,g.change.text).on("mouseleave"+x,g.reset.text).on("click"+x,g.toggle.state)),g.instantiate()},instantiate:function(){g.verbose("Storing instance of module",g),y=g,p.data(h,g)},destroy:function(){g.verbose("Destroying previous module",y),p.off(x).removeData(h)},refresh:function(){g.verbose("Refreshing selector cache"),p=e(w)},add:{defaults:function(){var n=t&&e.isPlainObject(t.states)?t.states:{};e.each(i.defaults,function(t,a){g.is[t]!==o&&g.is[t]()&&(g.verbose("Adding default states",t,w),e.extend(i.states,a,n))})}},is:{active:function(){return p.hasClass(v.active)},loading:function(){return p.hasClass(v.loading)},inactive:function(){return!p.hasClass(v.active)},enabled:function(){return!p.is(i.filter.active)},disabled:function(){return p.is(i.filter.active)},textEnabled:function(){return!p.is(i.filter.text)},button:function(){return p.is(".button:not(a, .submit)")},input:function(){return p.is("input")}},allow:function(e){g.debug("Now allowing state",e),b[e]=!0},disallow:function(e){g.debug("No longer allowing",e),b[e]=!1},allows:function(e){return b[e]||!1},enable:{state:function(e){g.allows(e)&&p.addClass(v[e])},focus:function(){p.addClass(v.focus)},hover:function(){p.addClass(v.hover)},down:function(){p.addClass(v.down)}},disable:{state:function(e){g.allows(e)&&p.removeClass(v[e])},focus:function(){p.removeClass(v.focus)},hover:function(){p.removeClass(v.hover)},down:function(){p.removeClass(v.down)}},toggle:{state:function(){var e=p.data(f.promise);g.allows("active")&&g.is.enabled()&&(g.refresh(),e!==o?g.listenTo(e):g.change.state())}},listenTo:function(t){g.debug("API request detected, waiting for state signal",t),t?(m.loading&&g.update.text(m.loading),e.when(t).then(function(){"resolved"==t.state()?(g.debug("API request succeeded"),i.activateTest=function(){return!0},i.deactivateTest=function(){return!0}):(g.debug("API request failed"),i.activateTest=function(){return!1},i.deactivateTest=function(){return!1}),g.change.state()})):(i.activateTest=function(){return!1},i.deactivateTest=function(){return!1})},change:{state:function(){g.debug("Determining state change direction"),g.is.inactive()?g.activate():g.deactivate(),i.sync&&g.sync(),e.proxy(i.onChange,w)()},text:function(){g.is.textEnabled()&&(g.is.active()?m.hover?(g.verbose("Changing text to hover text",m.hover),g.update.text(m.hover)):m.disable&&(g.verbose("Changing text to disable text",m.disable),g.update.text(m.disable)):m.hover?(g.verbose("Changing text to hover text",m.disable),g.update.text(m.hover)):m.enable&&(g.verbose("Changing text to enable text",m.enable),g.update.text(m.enable)))}},activate:function(){e.proxy(i.activateTest,w)()&&(g.debug("Setting state to active"),p.addClass(v.active),g.update.text(m.active)),e.proxy(i.onActivate,w)()},deactivate:function(){e.proxy(i.deactivateTest,w)()&&(g.debug("Setting state to inactive"),p.removeClass(v.active),g.update.text(m.inactive)),e.proxy(i.onDeactivate,w)()},sync:function(){g.verbose("Syncing other buttons to current state"),a.not(p).state(g.is.active()?"activate":"deactivate")},get:{text:function(){return i.selector.text?p.find(i.selector.text).text():p.html()},textFor:function(e){return m[e]||!1}},flash:{text:function(e,t){var n=g.get.text();g.debug("Flashing text message",e,t),e=e||i.text.flash,t=t||i.flashDuration,g.update.text(e),setTimeout(function(){g.update.text(n)},t)}},reset:{text:function(){var e=m.active||p.data(f.storedText),t=m.inactive||p.data(f.storedText);g.is.textEnabled()&&(g.is.active()&&e?(g.verbose("Resetting active text",e),g.update.text(e)):t&&(g.verbose("Resetting inactive text",e),g.update.text(t)))}},update:{text:function(e){var t=g.get.text();e&&e!==t?(g.debug("Updating text",e),i.selector.text?p.data(f.storedText,e).find(i.selector.text).text(e):p.data(f.storedText,e).html(e)):g.debug("Text is already sane, ignoring update",e)}},setting:function(t,n){return g.debug("Changing setting",t,n),n===o?i[t]:void(e.isPlainObject(t)?e.extend(!0,i,t):i[t]=n)},internal:function(t,n){return g.debug("Changing internal",t,n),n===o?g[t]:void(e.isPlainObject(t)?e.extend(!0,g,t):g[t]=n)},debug:function(){i.debug&&(i.performance?g.performance.log(arguments):(g.debug=Function.prototype.bind.call(console.info,console,i.name+":"),g.debug.apply(console,arguments)))},verbose:function(){i.verbose&&i.debug&&(i.performance?g.performance.log(arguments):(g.verbose=Function.prototype.bind.call(console.info,console,i.name+":"),g.verbose.apply(console,arguments)))},error:function(){g.error=Function.prototype.bind.call(console.error,console,i.name+":"),g.error.apply(console,arguments)},performance:{log:function(e){var t,n,o;i.performance&&(t=(new Date).getTime(),o=r||t,n=t-o,r=t,c.push({Element:w,Name:e[0],Arguments:[].slice.call(e,1)||"","Execution Time":n})),clearTimeout(g.performance.timer),g.performance.timer=setTimeout(g.performance.display,100)},display:function(){var t=i.name+":",n=0;r=!1,clearTimeout(g.performance.timer),e.each(c,function(e,t){n+=t["Execution Time"]}),t+=" "+n+"ms",s&&(t+=" '"+s+"'"),a.size()>1&&(t+=" ("+a.size()+")"),(console.group!==o||console.table!==o)&&c.length>0&&(console.groupCollapsed(t),console.table?console.table(c):e.each(c,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),c=[]}},invoke:function(t,a,i){var s,r,c,u=y;return a=a||d,i=w||i,"string"==typeof t&&u!==o&&(t=t.split(/[\. ]/),s=t.length-1,e.each(t,function(n,a){var i=n!=s?a+t[n+1].charAt(0).toUpperCase()+t[n+1].slice(1):t;if(e.isPlainObject(u[i])&&n!=s)u=u[i];else{if(u[i]!==o)return r=u[i],!1;if(!e.isPlainObject(u[a])||n==s)return u[a]!==o?(r=u[a],!1):!1;u=u[a]}})),e.isFunction(r)?c=r.apply(i,a):r!==o&&(c=r),e.isArray(n)?n.push(c):n!==o?n=[n,c]:c!==o&&(n=c),r}},l?(y===o&&g.initialize(),g.invoke(u)):(y!==o&&g.destroy(),g.initialize())}),n!==o?n:this},e.fn.state.settings={name:"State",debug:!0,verbose:!0,namespace:"state",performance:!0,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return!0},deactivateTest:function(){return!0},automatic:!0,sync:!1,flashDuration:3e3,filter:{text:".loading, .disabled",active:".disabled"},context:!1,error:{method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{focus:"focus",hover:"hover",down:"down",active:"active",loading:"loading"},selector:{text:!1},defaults:{input:{hover:!0,focus:!0,down:!0,loading:!1,active:!1},button:{hover:!0,focus:!1,down:!0,active:!0,loading:!0}},states:{hover:!0,focus:!0,down:!0,loading:!1,active:!1},text:{flash:!1,hover:!1,active:!1,inactive:!1,enable:!1,disable:!1}}}(jQuery,window,document);